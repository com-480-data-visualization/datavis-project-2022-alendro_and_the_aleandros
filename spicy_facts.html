<!DOCTYPE html>
<html>
    <head>
        <link rel = "stylesheet" href = "css/spicy_facts.css">

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
        integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
        crossorigin=""/>

        <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>
        <link rel="stylesheet" href="node_modules/leaflet.markercluster/dist/MarkerCluster.css">
        <link rel="stylesheet" href="node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css">
        <script src="node_modules/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
        <script src="https://d3js.org/d3.v7.min.js" charset="utf-8"></script>
        
        <div>
            <i class="arrow"></i>
        </div>
        <script src="js/goingback.js"></script>
    </head>

    <body>
        <div id="middle">
        <table border="0" cellpadding="10" style="overflow-y: scroll;">
            <tr>
                <td><div id="map"></div></td>
                <td><div id="table_container" class="csvTable"></div></td>
            </tr>
        </table>
        <script>
                var map = L.map('map').setView([54.05, -3.49], 5.75);

                    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                        maxZoom: 18,
                        id: 'mapbox/streets-v11',
                        tileSize: 512,
                        zoomOffset: -1,
                        accessToken: 'pk.eyJ1IjoicXVlbnRpbm11bGxlciIsImEiOiJjbDJoaHhuN3MwZHpjM2lwaG8zeTYxMGxjIn0.k47skeSjpBY-QnUQ7RvuJw'
                    }).addTo(map);
                
                    var markers = L.markerClusterGroup()

                d3.csv("https://raw.githubusercontent.com/com-480-data-visualization/datavis-project-2022-alendro_and_the_aleandros/master/open_pubs.csv").then(function (data) {
                    for (var i = 0; i < data.length; i++) {
                        // The condition below is there to take care of some lat/lon being /N and /N.
                        if(data[i].latitude != data[i].longitude) {
                            var marker = L.marker([data[i].latitude, data[i].longitude]);
                            marker.bindPopup(`Name: ${data[i].name}`).openPopup();
                            markers.addLayer(marker);
                        }
                }
                map.addLayer(markers);
                
            });

            var table = d3.select("#table_container").append("table")
            var thead = table.append('thead')
            var	tbody = table.append('tbody');
          // append the header row
            var columns = ['Spicy fact'];
            thead.append('tr')
                .selectAll('th')
                .data(columns).enter()
                .append('th')
                .text(function (column) { return column; });
            
            var jsonData = [{"fact":"Oldest Bar", "lat": 54.05, "lon": -3}, {"fact":"Newest Bar", "lat": 55.08, "lon":-2}];

            var rows = tbody.selectAll('tr')
            .data(jsonData)
            .enter()
            .append('tr');

            var cells = rows.selectAll('td')
            .data(function (row) {
              return columns.map(function (column) {
                return {column: column, value: row["fact"]};
              });
            })
            .enter()
            .append('td')
            .text(function (d) {return d.value;})
            .on("click",
             function(d, object){var latLon = getLongLatByName(object.value);
                    var lat = latLon[0]
                    var lon = latLon[1]
                    console.log(object)
                    map.flyTo([lat, lon], 12);});
            

            function getLongLatByName(name){
                for(let i = 0; i < jsonData.length; i++){
                    if(name == jsonData[i]["fact"]){
                        return [jsonData[i]["lat"], jsonData[i]["lon"]];
                    }
                }
            };
            
                </script>

           
            
            
    
            
  
    </body>
</html>